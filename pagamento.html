<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Pagamento - Full Fire</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      background: #111;
      color: white;
      font-family: Arial, sans-serif;
    }

    .pagamento-container {
      max-width: 600px;
      margin: 40px auto;
      padding: 20px;
      background: #1a1a1a;
      border-radius: 10px;
    }

    h2 {
      color: gold;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
    }

    input, select {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: none;
      font-size: 14px;
    }

    .botao {
      margin-top: 20px;
      padding: 12px 20px;
      font-size: 16px;
      background-color: gold;
      color: black;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
    }

    .info-pagamento {
      margin-top: 20px;
      padding: 15px;
      background: #222;
      border-radius: 8px;
    }

    .qr-simulado {
      width: 200px;
      height: 200px;
      background: white;
      margin: 10px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      color: black;
      font-weight: bold;
    }
  </style>
</head>
<body>

<header>
  <h1>Pagamento</h1>
</header>

<main>
  <div class="pagamento-container">
    <h2>Total a pagar: <span id="total"></span></h2>

    <div class="form-group">
      <label for="nome">Nome completo:</label>
      <input type="text" id="nome" placeholder="Seu nome" required>
    </div>

    <div class="form-group">
      <label for="email">E-mail:</label>
      <input type="email" id="email" placeholder="seu@email.com" required>
      <label for="celular">Celular:</label>
      <input type="tel" id="celular" name="celular" placeholder="(11) 91234-5678" required />
      <label for="endereco">Endereço:</label>
      <input type="text" id="endereco" placeholder="Rua, número, complemento" required>

      <label for="bairro">Bairro:</label>
      <input type="text" id="bairro" placeholder="Bairro" required>

      <label for="cidade">Cidade:</label>
      <input type="text" id="cidade" placeholder="Cidade" required>

      <label for="estado">Estado:</label>
      <input type="text" id="estado" placeholder="UF" required>
    </div>

    <div class="form-group">
      <label for="forma-pagamento">Forma de pagamento:</label>
      <select id="forma-pagamento" onchange="exibirCampos()">
        <option value="">Selecione</option>
        <option value="pix">PIX</option>
        <option value="boleto">Boleto</option>
        <option value="qrcode">QR Code</option>
        <option value="cartao">Cartão de Crédito</option>
      </select>
    </div>

    <div id="campos-adicionais" class="info-pagamento"></div>

    <button class="botao" onclick="confirmarPagamento()">Confirmar Pagamento</button>
  </div>

  <button onclick="history.back()" class="botao-voltar">← Voltar</button>
</main>

<footer>
  <p style="text-align:center;">&copy; 2025 Full Fire - Todos os direitos reservados.</p>
</footer>

<script>
  const carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
  const produtos = {
    15: { nome: "Caixa com 12 unidades", preco: 4.90 },
    14: { nome: "Caixa com 30 unidades", preco: 7.90 },
    13: { nome: "Caixa com 60 unidades", preco: 14.90 }
  };

  let total = 0;

  carrinho.forEach(item => {
    const produto = produtos[item.id];
    if (produto) {
    item.nome = produto.nome;
    item.preco = produto.preco;
    total += produto.preco * item.quantidade;
  } else {
    console.warn("Produto não encontrado para o ID:", item.id);
  }
});

  document.getElementById("total").innerText = "R$ " + total.toFixed(2);

  function exibirCampos() {
    const forma = document.getElementById("forma-pagamento").value;
    const campos = document.getElementById("campos-adicionais");

    if (forma === "pix") {
      campos.innerHTML = `
        <p id="pix-code"><strong>Código PIX:</strong> 00020126330014...etc</p>
      `;
    } else if (forma === "boleto") {
      campos.innerHTML = `
        <p><strong>Linha Digitável:</strong><br>34191.79001 01043.510047 91020.150008 7 89240000014500</p>
        <p><strong>Vencimento:</strong> 5 dias úteis</p>
      `;
    } else if (forma === "qrcode") {
      campos.innerHTML = `
        <p>Escaneie o QR Code abaixo com seu app bancário:</p>
        <div class="qr-simulado">QR CODE</div>
      `;
    } else if (forma === "cartao") {
      campos.innerHTML = `
        <div class="form-group">
          <label for="numero">Número do cartão:</label>
          <input type="text" id="numero" placeholder="1234 5678 9012 3456">
        </div>
        <div class="form-group">
          <label for="validade">Validade:</label>
          <input type="text" id="validade" placeholder="MM/AA">
        </div>
        <div class="form-group">
          <label for="cvv">CVV:</label>
          <input type="text" id="cvv" placeholder="123">
        </div>
      `;
    } else {
      campos.innerHTML = "";
    }
  }

   async function confirmarPagamento() {
    const nome = document.getElementById("nome").value.trim();
    const email = document.getElementById("email").value.trim();
    const celular = document.getElementById("celular").value.trim();
    const endereco = document.getElementById("endereco").value;
    const bairro = document.getElementById("bairro").value;
    const cidade = document.getElementById("cidade").value;
    const estado = document.getElementById("estado").value;
    const forma = document.getElementById("forma-pagamento").value;
    const carrinhoConfirmado = JSON.parse(localStorage.getItem("carrinho")) || [];

    if (!nome || !email || !celular || !endereco || !bairro || !cidade || !estado || !forma) {
  alert("Por favor, preencha todos os campos obrigatórios.");
  return;
}

    try {
    const resposta = await fetch("http://localhost:3000/pedidos", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        nome,
        email,
        celular,
        formaPagamento: forma,
        endereco,
        bairro,
        cidade,
        estado,
        carrinho: carrinhoConfirmado
      })
    });

    const resultado = await resposta.json();

    if (resultado.success) {
      localStorage.removeItem("carrinho");
      alert("Pedido finalizado com sucesso!");
      window.location.href = "sucesso.html";
    } else {
      alert("Erro ao finalizar o pedido.");
    }
  } catch (erro) {
    console.error("Erro ao enviar:", erro);
    alert("Erro ao enviar o pedido.");
  }
}
</script>

</body>
</html>